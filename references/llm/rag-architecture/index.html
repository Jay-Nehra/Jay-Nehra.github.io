
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Developer, learner, writer">
      
      
        <meta name="author" content="Jayant Nehra">
      
      
        <link rel="canonical" href="https://Jay-Nehra.github.io/references/llm/rag-architecture/">
      
      
        <link rel="prev" href="../api-patterns/">
      
      
        <link rel="next" href="../../databases/vector-databases/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>RAG Architecture from First Principles - Jayant Nehra</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="parchment" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rag-architecture-from-first-principles" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Jayant Nehra" class="md-header__button md-logo" aria-label="Jayant Nehra" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jayant Nehra
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RAG Architecture from First Principles
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="parchment" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to warm parchment"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to warm parchment" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="parchment-warm" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to solarized"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to solarized" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-2.69L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="solarized-teal" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark" for="__palette_3" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12h2v2h-2c-1.38 0-2.74-.35-4-1-2.5 1.3-5.5 1.3-8 0-1.26.65-2.63 1-4 1H2v-2h2c1.39 0 2.78-.47 4-1.33 2.44 1.71 5.56 1.71 8 0 1.22.86 2.61 1.33 4 1.33m0-6h2v2h-2c-1.38 0-2.74-.35-4-1-2.5 1.3-5.5 1.3-8 0-1.26.65-2.63 1-4 1H2V6h2c1.39 0 2.78-.47 4-1.33 2.44 1.71 5.56 1.71 8 0C17.22 5.53 18.61 6 20 6m0 12h2v2h-2c-1.38 0-2.74-.35-4-1-2.5 1.3-5.5 1.3-8 0-1.26.65-2.63 1-4 1H2v-2h2c1.39 0 2.78-.47 4-1.33 2.44 1.71 5.56 1.71 8 0 1.22.86 2.61 1.33 4 1.33"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="ink-dark" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to parchment"  type="radio" name="__palette" id="__palette_3">
    
      <label class="md-header__button md-icon" title="Switch to parchment" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Jay-Nehra/Jay-Nehra.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Jay-Nehra.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../about/" class="md-tabs__link">
        
  
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../portfolio/" class="md-tabs__link">
        
  
  
    
  
  Portfolio

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../resume/" class="md-tabs__link">
        
  
  
    
  
  Resume

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../notes/" class="md-tabs__link">
          
  
  
    
  
  Notes

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  References

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../concepts/" class="md-tabs__link">
          
  
  
    
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../snippets/" class="md-tabs__link">
          
  
  
    
  
  Snippets

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Jayant Nehra" class="md-nav__button md-logo" aria-label="Jayant Nehra" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Jayant Nehra
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Jay-Nehra/Jay-Nehra.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Jay-Nehra.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../portfolio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Portfolio
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../resume/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resume
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../blog/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/2026-01-why-i-built-this/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Why I Built This Site
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Notes
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Notes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Python
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Python
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/python/async-explained/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Understanding Python Async/Await
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/python/decorators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decorators
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/python/gil-explained/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gil explained
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/python/type-hints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Type hints
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Databases
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Databases
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/databases/indexing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Indexing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/databases/replication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Replication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/databases/transactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transactions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Web
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Web
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/web/authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/web/cors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cors
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/web/rest-apis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rest apis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    References
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    References
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../python/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Python Internals
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_2" id="__nav_7_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Python Internals
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/introspection-and-protocols/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introspection and Python Protocols
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/gil-and-threading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The GIL and Threading in Python
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/multiprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multiprocessing in Python
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/async-execution-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Async/Await Execution Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/memory-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Management in Python
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/decorators-and-closures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decorators and Closures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/generators-and-iteration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Generators and Iteration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/import-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Python Import System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/context-managers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context Managers and the with Statement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/common-gotchas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Common Python Gotchas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/fastapi-execution-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FastAPI Execution Model for LLM Applications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" checked>
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    LLM
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    LLM
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Architecture from First Principles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM API Execution Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    RAG Architecture from First Principles
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    RAG Architecture from First Principles
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-why-rag-exists" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Why RAG Exists
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Why RAG Exists">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-knowledge-cutoff-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Knowledge Cutoff Problem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-private-knowledge-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Private Knowledge Problem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fine-tuning-vs-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fine-Tuning vs Retrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-fundamental-insight-context-is-computation" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Fundamental Insight: Context Is Computation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-the-rag-pipeline-as-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. The RAG Pipeline as Execution Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. The RAG Pipeline as Execution Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-embed-retrieve-augment-generate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query → Embed → Retrieve → Augment → Generate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-happens-at-each-step" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Happens at Each Step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where-latency-lives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Where Latency Lives
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where-failures-happen" class="md-nav__link">
    <span class="md-ellipsis">
      
        Where Failures Happen
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-document-ingestion-the-offline-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Document Ingestion: The Offline Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Document Ingestion: The Offline Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#loading-documents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loading Documents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunking-why-it-exists" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunking: Why It Exists
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunk-size-tradeoffs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunk Size Tradeoffs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overlap-and-its-purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overlap and Its Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metadata Extraction
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-chunking-strategies-deep-dive" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Chunking Strategies Deep Dive
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Chunking Strategies Deep Dive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixed-size-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fixed-Size Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#semantic-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Semantic Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recursive-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recursive Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parent-child-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parent-Child Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-breaks-with-wrong-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Breaks with Wrong Chunking
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-embedding-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Embedding Models
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Embedding Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-embedding-models-actually-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Embedding Models Actually Do
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sentence-transformers-vs-openai-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sentence Transformers vs OpenAI Embeddings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dimension-vs-quality-tradeoffs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dimension vs Quality Tradeoffs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-embedding-for-performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Batch Embedding for Performance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-choice-when-it-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Model Choice: When It Matters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-retrieval-the-query-path" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Retrieval: The Query Path
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Retrieval: The Query Path">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-embedding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query Embedding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#top-k-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Top-K Retrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#similarity-thresholds-vs-fixed-k" class="md-nav__link">
    <span class="md-ellipsis">
      
        Similarity Thresholds vs Fixed K
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-relevant-means-and-doesnt" class="md-nav__link">
    <span class="md-ellipsis">
      
        What "Relevant" Means (and Doesn't)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-context-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Context Assembly
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Context Assembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ordering-retrieved-chunks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ordering Retrieved Chunks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deduplication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deduplication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-budget-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Token Budget Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-lost-in-the-middle-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The "Lost in the Middle" Problem
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-generation-with-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Generation with Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Generation with Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-prompt-design-for-rag" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Prompt Design for RAG
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grounding-the-model-in-retrieved-content" class="md-nav__link">
    <span class="md-ellipsis">
      
        Grounding the Model in Retrieved Content
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citation-and-attribution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Citation and Attribution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-i-dont-know" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling "I Don't Know"
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-what-breaks-in-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. What Breaks in Production
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. What Breaks in Production">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-document-mismatch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query-Document Mismatch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieval-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retrieval Failures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hallucination-despite-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hallucination Despite Context
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latency-at-scale" class="md-nav__link">
    <span class="md-ellipsis">
      
        Latency at Scale
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation-how-to-know-if-its-working" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evaluation: How to Know If It's Working
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-the-rag-mental-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary: The RAG Mental Model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interview-framing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interview Framing
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Databases
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Databases
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/vector-databases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vector Databases from First Principles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Data
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/text-data-engineering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Text Data Engineering for LLM Applications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/data-profiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Profiling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/data-cleaning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Cleaning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/quality-validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quality Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/correction-strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Correction Strategies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          <label class="md-nav__link" for="__nav_7_7" id="__nav_7_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Agents
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Agents
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/strands-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Strands Agents: Complete Systems Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
        
          
          <label class="md-nav__link" for="__nav_7_8" id="__nav_7_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environment Variables &amp; python-dotenv
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_9" >
        
          
          <label class="md-nav__link" for="__nav_7_9" id="__nav_7_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Serialization
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Serialization
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../serialization/json/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python's json Module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_10" >
        
          
          <label class="md-nav__link" for="__nav_7_10" id="__nav_7_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Filesystem
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Filesystem
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filesystem/pathlib/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python's pathlib Module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_11" >
        
          
          <label class="md-nav__link" for="__nav_7_11" id="__nav_7_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    HTTP
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    HTTP
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../http/httpx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    httpx - Modern HTTP Client
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_12" >
        
          
          <label class="md-nav__link" for="__nav_7_12" id="__nav_7_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    CLI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/argparse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python's argparse Module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../concepts/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/python-internals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Internals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/llm-systems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Systems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/agent-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/production-ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Production AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/system-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../snippets/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Snippets
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Snippets
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../snippets/bash-find-files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bash find files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../snippets/python-async-requests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python async requests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../snippets/python-retry-decorator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python: Retry Decorator with Exponential Backoff
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../snippets/sql-recursive-cte/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sql recursive cte
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-why-rag-exists" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Why RAG Exists
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Why RAG Exists">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-knowledge-cutoff-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Knowledge Cutoff Problem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-private-knowledge-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Private Knowledge Problem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fine-tuning-vs-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fine-Tuning vs Retrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-fundamental-insight-context-is-computation" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Fundamental Insight: Context Is Computation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-the-rag-pipeline-as-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. The RAG Pipeline as Execution Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. The RAG Pipeline as Execution Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-embed-retrieve-augment-generate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query → Embed → Retrieve → Augment → Generate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-happens-at-each-step" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Happens at Each Step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where-latency-lives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Where Latency Lives
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where-failures-happen" class="md-nav__link">
    <span class="md-ellipsis">
      
        Where Failures Happen
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-document-ingestion-the-offline-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Document Ingestion: The Offline Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Document Ingestion: The Offline Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#loading-documents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loading Documents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunking-why-it-exists" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunking: Why It Exists
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunk-size-tradeoffs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunk Size Tradeoffs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overlap-and-its-purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overlap and Its Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metadata Extraction
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-chunking-strategies-deep-dive" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Chunking Strategies Deep Dive
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Chunking Strategies Deep Dive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixed-size-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fixed-Size Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#semantic-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Semantic Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recursive-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recursive Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parent-child-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parent-Child Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-breaks-with-wrong-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Breaks with Wrong Chunking
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-embedding-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Embedding Models
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Embedding Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-embedding-models-actually-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Embedding Models Actually Do
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sentence-transformers-vs-openai-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sentence Transformers vs OpenAI Embeddings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dimension-vs-quality-tradeoffs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dimension vs Quality Tradeoffs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-embedding-for-performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Batch Embedding for Performance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-choice-when-it-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Model Choice: When It Matters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-retrieval-the-query-path" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Retrieval: The Query Path
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Retrieval: The Query Path">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-embedding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query Embedding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#top-k-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Top-K Retrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#similarity-thresholds-vs-fixed-k" class="md-nav__link">
    <span class="md-ellipsis">
      
        Similarity Thresholds vs Fixed K
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-relevant-means-and-doesnt" class="md-nav__link">
    <span class="md-ellipsis">
      
        What "Relevant" Means (and Doesn't)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-context-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Context Assembly
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Context Assembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ordering-retrieved-chunks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ordering Retrieved Chunks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deduplication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deduplication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-budget-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Token Budget Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-lost-in-the-middle-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The "Lost in the Middle" Problem
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-generation-with-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Generation with Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Generation with Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-prompt-design-for-rag" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Prompt Design for RAG
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grounding-the-model-in-retrieved-content" class="md-nav__link">
    <span class="md-ellipsis">
      
        Grounding the Model in Retrieved Content
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citation-and-attribution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Citation and Attribution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-i-dont-know" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling "I Don't Know"
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-what-breaks-in-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. What Breaks in Production
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. What Breaks in Production">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-document-mismatch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query-Document Mismatch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieval-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retrieval Failures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hallucination-despite-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hallucination Despite Context
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latency-at-scale" class="md-nav__link">
    <span class="md-ellipsis">
      
        Latency at Scale
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation-how-to-know-if-its-working" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evaluation: How to Know If It's Working
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-the-rag-mental-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary: The RAG Mental Model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interview-framing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interview Framing
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Jay-Nehra/Jay-Nehra.github.io/edit/main/docs/references/llm/rag-architecture.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="rag-architecture-from-first-principles">RAG Architecture from First Principles<a class="headerlink" href="#rag-architecture-from-first-principles" title="Permanent link">&para;</a></h1>
<p>Retrieval-Augmented Generation (RAG) is a pattern for giving LLMs access to knowledge they weren't trained on. This document explains RAG from the ground up: why it exists, how each component works, and what breaks in production.</p>
<p>Understanding RAG deeply means understanding that it is not a library or a tool — it is an execution pipeline with distinct phases, each with its own failure modes and optimization opportunities.</p>
<hr />
<h2 id="1-why-rag-exists">1. Why RAG Exists<a class="headerlink" href="#1-why-rag-exists" title="Permanent link">&para;</a></h2>
<p>RAG exists because LLMs have fundamental knowledge limitations that cannot be solved by the models themselves.</p>
<h3 id="the-knowledge-cutoff-problem">The Knowledge Cutoff Problem<a class="headerlink" href="#the-knowledge-cutoff-problem" title="Permanent link">&para;</a></h3>
<p>Every LLM is trained on data up to a specific point in time. GPT-4 might have a knowledge cutoff of April 2023. Claude might know about events up to January 2024. Anything that happened after the cutoff is unknown to the model.</p>
<p>This is not a bug or a limitation that can be trained away. It is inherent to how models are created. Training takes months and costs millions of dollars. Models cannot be continuously retrained with yesterday's news.</p>
<p>For any application that needs current information — stock prices, recent events, updated documentation, your company's internal data — the model's training data is insufficient.</p>
<h3 id="the-private-knowledge-problem">The Private Knowledge Problem<a class="headerlink" href="#the-private-knowledge-problem" title="Permanent link">&para;</a></h3>
<p>Even if you could continuously retrain, there's another problem: private knowledge.</p>
<p>Your company's internal documents, customer data, proprietary research — none of this was in the training data. The model has never seen it and cannot answer questions about it.</p>
<p>You could fine-tune the model on your data, but this is:
- Expensive (thousands to millions of dollars)
- Slow (weeks to months)
- Inflexible (can't easily update)
- Potentially insecure (your data becomes part of the model)</p>
<p>RAG offers an alternative: keep your data in a database, retrieve relevant pieces at query time, and inject them into the prompt.</p>
<h3 id="fine-tuning-vs-retrieval">Fine-Tuning vs Retrieval<a class="headerlink" href="#fine-tuning-vs-retrieval" title="Permanent link">&para;</a></h3>
<p>Fine-tuning and retrieval solve different problems:</p>
<p><strong>Fine-tuning</strong> teaches the model new behaviors, styles, or formats. It changes how the model responds. Use it for:
- Custom response styles
- Domain-specific terminology
- Following specific formats
- Adjusting tone and personality</p>
<p><strong>Retrieval</strong> gives the model access to facts it doesn't know. It changes what the model knows for a specific query. Use it for:
- Current information
- Private/proprietary data
- Large document collections
- Frequently updated knowledge</p>
<p>Most applications need retrieval, not fine-tuning. Fine-tuning is for changing behavior; RAG is for adding knowledge.</p>
<h3 id="the-fundamental-insight-context-is-computation">The Fundamental Insight: Context Is Computation<a class="headerlink" href="#the-fundamental-insight-context-is-computation" title="Permanent link">&para;</a></h3>
<p>Here's the key insight that makes RAG work:</p>
<p>LLMs can effectively use information placed in their context window. If you put relevant text in the prompt, the model can reason about it, synthesize it, and answer questions about it.</p>
<p>This means you can "teach" the model anything at query time by putting it in the context. No training required. The model reads the context, understands it, and uses it to generate a response.</p>
<p>RAG is simply: (1) figure out what context is relevant, and (2) put it in the prompt.</p>
<hr />
<h2 id="2-the-rag-pipeline-as-execution-flow">2. The RAG Pipeline as Execution Flow<a class="headerlink" href="#2-the-rag-pipeline-as-execution-flow" title="Permanent link">&para;</a></h2>
<p>RAG is a pipeline with distinct phases. Understanding each phase helps you debug problems and optimize performance.</p>
<h3 id="query-embed-retrieve-augment-generate">Query → Embed → Retrieve → Augment → Generate<a class="headerlink" href="#query-embed-retrieve-augment-generate" title="Permanent link">&para;</a></h3>
<p>The complete flow for a RAG query:</p>
<ol>
<li><strong>Query arrives:</strong> User asks a question</li>
<li><strong>Query embedding:</strong> Convert the question to a vector representation</li>
<li><strong>Retrieval:</strong> Search your knowledge base for relevant documents</li>
<li><strong>Augmentation:</strong> Construct a prompt with retrieved context</li>
<li><strong>Generation:</strong> Send to LLM, receive response</li>
</ol>
<p>Each phase has latency, cost, and failure modes.</p>
<h3 id="what-happens-at-each-step">What Happens at Each Step<a class="headerlink" href="#what-happens-at-each-step" title="Permanent link">&para;</a></h3>
<p><strong>Query embedding:</strong> Your question ("How do I reset my password?") is passed through an embedding model. This produces a vector — a list of numbers that represents the semantic meaning of the question. This typically takes 10-50ms.</p>
<p><strong>Retrieval:</strong> The query vector is compared against pre-computed document vectors in a vector database. The database returns the top-k most similar documents. This typically takes 10-100ms depending on database size and infrastructure.</p>
<p><strong>Augmentation:</strong> You construct a prompt that includes:
- A system message explaining the task
- The retrieved documents as context
- The user's original question
This is just string formatting — essentially free.</p>
<p><strong>Generation:</strong> The augmented prompt is sent to the LLM. The model reads the context and generates a response. This is the slowest and most expensive step, typically 1-30 seconds.</p>
<h3 id="where-latency-lives">Where Latency Lives<a class="headerlink" href="#where-latency-lives" title="Permanent link">&para;</a></h3>
<p>Total RAG latency is dominated by generation. A typical breakdown:
- Query embedding: 20ms
- Vector search: 50ms<br />
- Prompt construction: 1ms
- LLM generation: 2000-5000ms</p>
<p>For optimization, focus on generation first. Reducing context size reduces generation time. Caching repeated queries avoids generation entirely.</p>
<h3 id="where-failures-happen">Where Failures Happen<a class="headerlink" href="#where-failures-happen" title="Permanent link">&para;</a></h3>
<p>Each phase can fail:</p>
<p><strong>Embedding:</strong> The embedding model might be unavailable or rate-limited.</p>
<p><strong>Retrieval:</strong> The query might not match relevant documents (semantic gap). The documents might not contain the answer. The vector database might be slow or unavailable.</p>
<p><strong>Augmentation:</strong> Context might exceed token limits. Prompt might be malformed.</p>
<p><strong>Generation:</strong> LLM might be unavailable, rate-limited, or produce low-quality output. Model might ignore context and hallucinate.</p>
<p>Understanding where failure occurs is essential for debugging. A wrong answer could be a retrieval failure (wrong documents retrieved) or a generation failure (right documents, wrong interpretation).</p>
<hr />
<h2 id="3-document-ingestion-the-offline-pipeline">3. Document Ingestion: The Offline Pipeline<a class="headerlink" href="#3-document-ingestion-the-offline-pipeline" title="Permanent link">&para;</a></h2>
<p>Before you can retrieve documents, you must process and index them. This happens offline, before any queries.</p>
<h3 id="loading-documents">Loading Documents<a class="headerlink" href="#loading-documents" title="Permanent link">&para;</a></h3>
<p>Documents come in many formats:
- Plain text
- Markdown
- PDF
- Word documents
- HTML
- Code files</p>
<p>Each format requires different parsing. PDFs are particularly challenging — they're designed for visual display, not text extraction. OCR may be needed for scanned documents.</p>
<p>The goal of loading is to extract clean text that preserves the document's meaning. This is harder than it sounds:
- Headers and footers appear on every page
- Tables lose structure when converted to text
- Images and diagrams are lost
- Multi-column layouts scramble reading order</p>
<p>Garbage in, garbage out. Bad document parsing produces bad retrieval.</p>
<h3 id="chunking-why-it-exists">Chunking: Why It Exists<a class="headerlink" href="#chunking-why-it-exists" title="Permanent link">&para;</a></h3>
<p>Documents are typically too large to fit in context. A 50-page PDF might be 30,000 tokens. You can't pass the whole thing to the LLM for every query.</p>
<p>Chunking breaks documents into smaller pieces. Each chunk is embedded and indexed separately. At query time, you retrieve individual chunks, not whole documents.</p>
<p>Chunking serves two purposes:
1. <strong>Fit in context:</strong> Chunks are small enough to include multiple in a single prompt
2. <strong>Improve retrieval precision:</strong> Smaller chunks can match more specific queries</p>
<h3 id="chunk-size-tradeoffs">Chunk Size Tradeoffs<a class="headerlink" href="#chunk-size-tradeoffs" title="Permanent link">&para;</a></h3>
<p>Chunk size is one of the most important parameters in RAG.</p>
<p><strong>Too small (&lt; 200 tokens):</strong>
- Individual chunks lack context
- "The meeting" — which meeting?
- More chunks means more noise in retrieval
- Higher chance of breaking mid-sentence or mid-thought</p>
<p><strong>Too large (&gt; 1000 tokens):</strong>
- Chunks contain multiple topics
- Retrieval becomes less precise
- Fewer chunks fit in context
- Pay for irrelevant content</p>
<p><strong>Typical range:</strong> 300-800 tokens</p>
<p>The right size depends on your documents and queries. Technical documentation might need larger chunks to preserve code blocks. FAQs might work well with smaller chunks.</p>
<h3 id="overlap-and-its-purpose">Overlap and Its Purpose<a class="headerlink" href="#overlap-and-its-purpose" title="Permanent link">&para;</a></h3>
<p>Chunks typically overlap — the end of one chunk is the beginning of the next.</p>
<p>Why overlap?</p>
<p>Without overlap, a relevant sentence might be split between chunks. Neither chunk contains the complete thought. With overlap, the sentence appears in full in at least one chunk.</p>
<p>Typical overlap: 10-20% of chunk size. A 500-token chunk might overlap by 50-100 tokens.</p>
<p>More overlap means more redundancy (higher storage, slower indexing) but better retrieval coverage.</p>
<h3 id="metadata-extraction">Metadata Extraction<a class="headerlink" href="#metadata-extraction" title="Permanent link">&para;</a></h3>
<p>Each chunk should carry metadata:
- Source document (title, URL, file path)
- Position in document (page number, section heading)
- Timestamps (creation date, last modified)
- Custom fields (author, category, access level)</p>
<p>Metadata enables:
- Filtering retrieval (only search documents from 2024)
- Attribution in responses ("According to the Q3 report...")
- Access control (only show documents user can access)</p>
<p>Don't skip metadata. It's essential for production systems.</p>
<hr />
<h2 id="4-chunking-strategies-deep-dive">4. Chunking Strategies Deep Dive<a class="headerlink" href="#4-chunking-strategies-deep-dive" title="Permanent link">&para;</a></h2>
<p>Chunking is not just "split by character count." Different strategies produce dramatically different results.</p>
<h3 id="fixed-size-chunking">Fixed-Size Chunking<a class="headerlink" href="#fixed-size-chunking" title="Permanent link">&para;</a></h3>
<p>The simplest approach: split text every N characters or tokens.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">fixed_size_chunk</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">chunk_size</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">overlap</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="k">return</span> <span class="n">chunks</span>
</span></code></pre></div>
<p><strong>Pros:</strong>
- Simple to implement
- Predictable chunk sizes
- Works for any text</p>
<p><strong>Cons:</strong>
- Ignores document structure
- Cuts mid-sentence, mid-paragraph, mid-word
- Semantic units are broken arbitrarily</p>
<p>This is often "good enough" for prototypes but rarely optimal.</p>
<h3 id="semantic-chunking">Semantic Chunking<a class="headerlink" href="#semantic-chunking" title="Permanent link">&para;</a></h3>
<p>Split at natural boundaries: sentences, paragraphs, or sections.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">sentence_chunk</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">):</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="n">sentences</span> <span class="o">=</span> <span class="n">split_into_sentences</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="n">current_chunk</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="n">current_tokens</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>        <span class="n">sentence_tokens</span> <span class="o">=</span> <span class="n">count_tokens</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>        <span class="k">if</span> <span class="n">current_tokens</span> <span class="o">+</span> <span class="n">sentence_tokens</span> <span class="o">&gt;</span> <span class="n">max_tokens</span> <span class="ow">and</span> <span class="n">current_chunk</span><span class="p">:</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">))</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>            <span class="n">current_chunk</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>            <span class="n">current_tokens</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>        <span class="n">current_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>        <span class="n">current_tokens</span> <span class="o">+=</span> <span class="n">sentence_tokens</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    <span class="k">if</span> <span class="n">current_chunk</span><span class="p">:</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">))</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    <span class="k">return</span> <span class="n">chunks</span>
</span></code></pre></div>
<p><strong>Pros:</strong>
- Preserves sentence integrity
- More coherent chunks
- Better for natural language documents</p>
<p><strong>Cons:</strong>
- Chunk sizes vary more
- Very long sentences cause problems
- Doesn't respect higher-level structure</p>
<h3 id="recursive-chunking">Recursive Chunking<a class="headerlink" href="#recursive-chunking" title="Permanent link">&para;</a></h3>
<p>Split by document structure, falling back to smaller units as needed.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">recursive_chunk</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">separators</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="k">if</span> <span class="n">separators</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>        <span class="n">separators</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;. &quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">]</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="k">if</span> <span class="n">count_tokens</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_tokens</span><span class="p">:</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">text</span><span class="p">]</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="k">for</span> <span class="n">separator</span> <span class="ow">in</span> <span class="n">separators</span><span class="p">:</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>        <span class="k">if</span> <span class="n">separator</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>            <span class="n">parts</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>            <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>                <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">recursive_chunk</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">,</span> <span class="n">separators</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>            <span class="k">return</span> <span class="n">chunks</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    <span class="c1"># Fallback: character split</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    <span class="k">return</span> <span class="n">fixed_size_chunk</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Pros:</strong>
- Respects document structure (sections, paragraphs)
- Falls back gracefully
- Works well for structured documents (Markdown, documentation)</p>
<p><strong>Cons:</strong>
- More complex
- Behavior depends on document format
- May produce very small chunks for odd documents</p>
<h3 id="parent-child-chunking">Parent-Child Chunking<a class="headerlink" href="#parent-child-chunking" title="Permanent link">&para;</a></h3>
<p>Store small chunks for retrieval but return larger context.</p>
<p>The idea: embed small, precise chunks (200 tokens) for accurate matching. But when returning context, include the parent chunk (1000 tokens) for completeness.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># During indexing</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">:</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="n">large_chunks</span> <span class="o">=</span> <span class="n">split_into_large_chunks</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">large_chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">large_chunks</span><span class="p">):</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        <span class="n">small_chunks</span> <span class="o">=</span> <span class="n">split_into_small_chunks</span><span class="p">(</span><span class="n">large_chunk</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">small_chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">small_chunks</span><span class="p">):</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>            <span class="n">store</span><span class="p">({</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">small_chunk</span><span class="p">,</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>                <span class="s2">&quot;embedding&quot;</span><span class="p">:</span> <span class="n">embed</span><span class="p">(</span><span class="n">small_chunk</span><span class="p">),</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>                <span class="s2">&quot;parent_text&quot;</span><span class="p">:</span> <span class="n">large_chunk</span><span class="p">,</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>                <span class="s2">&quot;parent_id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>            <span class="p">})</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="c1"># During retrieval</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="n">results</span> <span class="o">=</span> <span class="n">vector_db</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query_embedding</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="c1"># Return parent_text instead of text</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="n">contexts</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">parent_text</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span></code></pre></div>
<p><strong>Pros:</strong>
- Precise retrieval + complete context
- Best of both worlds</p>
<p><strong>Cons:</strong>
- More storage
- More complex indexing
- Must deduplicate parents</p>
<h3 id="what-breaks-with-wrong-chunking">What Breaks with Wrong Chunking<a class="headerlink" href="#what-breaks-with-wrong-chunking" title="Permanent link">&para;</a></h3>
<p>Chunking failures are common and hard to diagnose:</p>
<p><strong>Chunks too small:</strong> "When was the product launched?" retrieves "launched in 2023" but lacks product name. Model can't answer.</p>
<p><strong>Chunks too large:</strong> Multiple products in one chunk. Query retrieves chunk but model cites wrong product.</p>
<p><strong>Mid-thought breaks:</strong> Chunk ends with "The solution is to" — next chunk has the solution but wasn't retrieved.</p>
<p><strong>Code blocks split:</strong> Function definition in one chunk, body in another. Neither is useful alone.</p>
<p>Test chunking with real queries before going to production.</p>
<hr />
<h2 id="5-embedding-models">5. Embedding Models<a class="headerlink" href="#5-embedding-models" title="Permanent link">&para;</a></h2>
<p>Embedding models convert text to vectors. Understanding how they work helps you make better choices.</p>
<h3 id="what-embedding-models-actually-do">What Embedding Models Actually Do<a class="headerlink" href="#what-embedding-models-actually-do" title="Permanent link">&para;</a></h3>
<p>An embedding model is a neural network trained to map text to a fixed-size vector of floating-point numbers. Similar texts produce similar vectors (close in vector space). Dissimilar texts produce distant vectors.</p>
<p>The training objective is usually "contrastive": push similar pairs together, push dissimilar pairs apart. Models are trained on massive datasets of text pairs, learning general semantic similarity.</p>
<h3 id="sentence-transformers-vs-openai-embeddings">Sentence Transformers vs OpenAI Embeddings<a class="headerlink" href="#sentence-transformers-vs-openai-embeddings" title="Permanent link">&para;</a></h3>
<p>Two main options:</p>
<p><strong>Sentence Transformers (open source):</strong>
- Run locally or self-hosted
- No API costs
- Lower latency (no network)
- Full control
- Many models, varying quality
- Popular: all-MiniLM-L6-v2 (384 dim), all-mpnet-base-v2 (768 dim)</p>
<p><strong>OpenAI/Commercial embeddings:</strong>
- Hosted API
- Per-token pricing
- Higher latency (network)
- Generally higher quality for general text
- Less control
- Popular: text-embedding-3-small (1536 dim), text-embedding-3-large (3072 dim)</p>
<p>For most applications, either works. Choose based on:
- Cost sensitivity (self-host = cheaper at scale)
- Quality requirements (commercial often better for general text)
- Latency requirements (local = faster)
- Operational complexity (API = simpler)</p>
<h3 id="dimension-vs-quality-tradeoffs">Dimension vs Quality Tradeoffs<a class="headerlink" href="#dimension-vs-quality-tradeoffs" title="Permanent link">&para;</a></h3>
<p>Embedding dimension affects:</p>
<p><strong>Storage:</strong> 1536-dim vectors use 4x the storage of 384-dim vectors.</p>
<p><strong>Search speed:</strong> Higher dimensions slow search, especially brute-force.</p>
<p><strong>Quality:</strong> More dimensions can capture more nuance, but diminishing returns apply.</p>
<p>Modern models often support "Matryoshka" embeddings — you can truncate the vector to fewer dimensions with graceful degradation. This enables tuning the dimension/quality tradeoff at query time.</p>
<h3 id="batch-embedding-for-performance">Batch Embedding for Performance<a class="headerlink" href="#batch-embedding-for-performance" title="Permanent link">&para;</a></h3>
<p>Embedding is parallelizable. For ingestion, batch documents:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Bad: one document at a time</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">:</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="n">embedding</span> <span class="o">=</span> <span class="n">embed</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>  <span class="c1"># One API call per document</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="n">store</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">embedding</span><span class="p">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="c1"># Good: batch processing</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">batch</span> <span class="o">=</span> <span class="n">documents</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="n">embeddings</span> <span class="o">=</span> <span class="n">embed_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>  <span class="c1"># One API call per batch</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="k">for</span> <span class="n">doc</span><span class="p">,</span> <span class="n">embedding</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">):</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>        <span class="n">store</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">embedding</span><span class="p">)</span>
</span></code></pre></div>
<p>This dramatically reduces:
- Total time (parallelism)
- API calls (relevant for hosted models)
- Network overhead</p>
<h3 id="model-choice-when-it-matters">Model Choice: When It Matters<a class="headerlink" href="#model-choice-when-it-matters" title="Permanent link">&para;</a></h3>
<p>Embedding model choice matters most when:</p>
<p><strong>Domain-specific content:</strong> General models may miss domain terminology. Consider domain-specific models or fine-tuning.</p>
<p><strong>Multiple languages:</strong> Some models are English-only. Check language support.</p>
<p><strong>Code:</strong> Code embeddings need code-aware models. General text models often fail.</p>
<p><strong>Very short queries:</strong> Some models are optimized for short queries vs. long documents.</p>
<p><strong>Asymmetric search:</strong> Query style differs from document style (questions vs. answers). Some models handle this better.</p>
<p>When in doubt, test. Create a small benchmark of queries and relevant documents, then measure retrieval quality with different models.</p>
<hr />
<h2 id="6-retrieval-the-query-path">6. Retrieval: The Query Path<a class="headerlink" href="#6-retrieval-the-query-path" title="Permanent link">&para;</a></h2>
<p>When a query arrives, you must find the most relevant documents. This is where the quality of your RAG system is often determined.</p>
<h3 id="query-embedding">Query Embedding<a class="headerlink" href="#query-embedding" title="Permanent link">&para;</a></h3>
<p>The query is embedded using the same model used for documents. This is essential — different models produce incompatible embeddings.</p>
<p>Query embedding is usually fast (10-50ms for a short query). It's also cacheable — identical queries can reuse embeddings.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;How do I reset my password?&quot;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">query_embedding</span> <span class="o">=</span> <span class="n">embed</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>  <span class="c1"># Same model as documents</span>
</span></code></pre></div>
<h3 id="top-k-retrieval">Top-K Retrieval<a class="headerlink" href="#top-k-retrieval" title="Permanent link">&para;</a></h3>
<p>The query embedding is compared against all document embeddings. The most similar documents are returned.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">results</span> <span class="o">=</span> <span class="n">vector_db</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="n">vector</span><span class="o">=</span><span class="n">query_embedding</span><span class="p">,</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Return 5 most similar</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="nb">filter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;documentation&quot;</span><span class="p">}</span>  <span class="c1"># Optional metadata filter</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="p">)</span>
</span></code></pre></div>
<p>The "top-k" parameter controls how many results to return. Common values are 3-10.</p>
<p>More results mean:
- Higher chance of including the relevant document
- More tokens in context (higher cost)
- More noise (irrelevant documents)</p>
<p>Fewer results mean:
- Lower cost
- Higher risk of missing relevant content
- Less noise (if retrieval is good)</p>
<h3 id="similarity-thresholds-vs-fixed-k">Similarity Thresholds vs Fixed K<a class="headerlink" href="#similarity-thresholds-vs-fixed-k" title="Permanent link">&para;</a></h3>
<p>Two approaches to filtering results:</p>
<p><strong>Fixed K:</strong> Always return exactly K results.
- Predictable token count
- May return irrelevant results if no good matches
- May miss relevant results if K is too small</p>
<p><strong>Similarity threshold:</strong> Return results above a similarity score.
- Variable result count
- Avoids low-quality matches
- May return nothing for unusual queries
- Threshold tuning is difficult</p>
<p>In practice, combining both often works well: return up to K results, but only those above a minimum similarity threshold.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">results</span> <span class="o">=</span> <span class="n">vector_db</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="n">vector</span><span class="o">=</span><span class="n">query_embedding</span><span class="p">,</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="n">top_k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># Maximum results</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="p">)</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="c1"># Filter by score</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">]</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="c1"># Limit to 5</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</span></code></pre></div>
<h3 id="what-relevant-means-and-doesnt">What "Relevant" Means (and Doesn't)<a class="headerlink" href="#what-relevant-means-and-doesnt" title="Permanent link">&para;</a></h3>
<p>Vector similarity measures semantic similarity — whether two texts are "about the same thing."</p>
<p>Similarity does NOT measure:
- <strong>Correctness:</strong> A document might be semantically similar but factually wrong
- <strong>Answer presence:</strong> A document about the topic might not contain the answer
- <strong>Recency:</strong> Old and new documents on the same topic are equally similar
- <strong>Authority:</strong> All sources are equal in vector space</p>
<p>High similarity means "related topic." It does not mean "good answer."</p>
<p>This is why retrieval is necessary but not sufficient. You still need the LLM to interpret and synthesize the retrieved content.</p>
<hr />
<h2 id="7-context-assembly">7. Context Assembly<a class="headerlink" href="#7-context-assembly" title="Permanent link">&para;</a></h2>
<p>After retrieval, you must construct a prompt for the LLM. This step is often underestimated.</p>
<h3 id="ordering-retrieved-chunks">Ordering Retrieved Chunks<a class="headerlink" href="#ordering-retrieved-chunks" title="Permanent link">&para;</a></h3>
<p>Retrieved chunks can be ordered by:
- Similarity score (most similar first)
- Document order (original sequence)
- Recency (newest first)
- Custom ranking</p>
<p>Order matters because of position bias in LLMs. Some models pay more attention to content at the beginning or end of the context, less to the middle (the "lost in the middle" problem).</p>
<p>If you suspect position bias, put the most relevant content first and last.</p>
<h3 id="deduplication">Deduplication<a class="headerlink" href="#deduplication" title="Permanent link">&para;</a></h3>
<p>If you use parent-child chunking or overlapping chunks, retrieved content may be redundant. The same sentence might appear in multiple chunks.</p>
<p>Deduplicate before constructing context:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">deduplicate_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="n">unique</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>        <span class="c1"># Simple approach: dedupe by exact match</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>        <span class="k">if</span> <span class="n">chunk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>            <span class="n">unique</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    <span class="k">return</span> <span class="n">unique</span>
</span></code></pre></div>
<p>For overlapping chunks, you might merge overlapping text regions rather than simple deduplication.</p>
<h3 id="token-budget-management">Token Budget Management<a class="headerlink" href="#token-budget-management" title="Permanent link">&para;</a></h3>
<p>Your context window is limited. Budget tokens across:
- System prompt (usually fixed)
- Retrieved context (variable)
- Conversation history (variable)
- Reserved for output (must leave room)</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">MAX_CONTEXT</span> <span class="o">=</span> <span class="mi">8000</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">SYSTEM_PROMPT_TOKENS</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">MAX_OUTPUT_TOKENS</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="n">MAX_RETRIEVED_TOKENS</span> <span class="o">=</span> <span class="n">MAX_CONTEXT</span> <span class="o">-</span> <span class="n">SYSTEM_PROMPT_TOKENS</span> <span class="o">-</span> <span class="n">MAX_OUTPUT_TOKENS</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">fit_chunks_to_budget</span><span class="p">(</span><span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">budget</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    <span class="n">used</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>        <span class="n">chunk_tokens</span> <span class="o">=</span> <span class="n">count_tokens</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>        <span class="k">if</span> <span class="n">used</span> <span class="o">+</span> <span class="n">chunk_tokens</span> <span class="o">&gt;</span> <span class="n">budget</span><span class="p">:</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>            <span class="k">break</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>        <span class="n">used</span> <span class="o">+=</span> <span class="n">chunk_tokens</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>    <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div>
<p>If you exceed the context, either truncate or summarize. Never send requests that exceed limits.</p>
<h3 id="the-lost-in-the-middle-problem">The "Lost in the Middle" Problem<a class="headerlink" href="#the-lost-in-the-middle-problem" title="Permanent link">&para;</a></h3>
<p>Research shows that LLMs often pay more attention to content at the beginning and end of long contexts, with reduced attention to content in the middle.</p>
<p>For RAG, this means:
- Highly relevant content in the middle may be ignored
- The model might answer from less-relevant content at edges
- Very long contexts can actually reduce quality</p>
<p>Mitigations:
- Keep contexts shorter (5-10 chunks, not 50)
- Put most relevant content first
- Consider reranking retrieved chunks
- Use models specifically optimized for long contexts</p>
<hr />
<h2 id="8-generation-with-context">8. Generation with Context<a class="headerlink" href="#8-generation-with-context" title="Permanent link">&para;</a></h2>
<p>The final step: sending the assembled prompt to the LLM and getting a response.</p>
<h3 id="system-prompt-design-for-rag">System Prompt Design for RAG<a class="headerlink" href="#system-prompt-design-for-rag" title="Permanent link">&para;</a></h3>
<p>Your system prompt should:
1. Explain the model's role
2. Describe how to use the provided context
3. Set expectations for handling missing information</p>
<p>Example:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>You are a helpful assistant that answers questions based on the provided context.
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>Instructions:
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>- Answer the user&#39;s question using ONLY the information in the context below.
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>- If the context does not contain the answer, say &quot;I don&#39;t have information about that in the provided documents.&quot;
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>- When possible, cite which document your answer came from.
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>- Do not make up information that is not in the context.
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>Context:
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>{retrieved_documents}
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>User question: {query}
</span></code></pre></div>
<p>Be explicit. Don't assume the model will figure out what you want.</p>
<h3 id="grounding-the-model-in-retrieved-content">Grounding the Model in Retrieved Content<a class="headerlink" href="#grounding-the-model-in-retrieved-content" title="Permanent link">&para;</a></h3>
<p>The goal of RAG is grounded generation — answers based on your documents, not the model's training.</p>
<p>But models can still:
- Hallucinate additional details
- Combine context with training knowledge
- Ignore context entirely for confident answers</p>
<p>Reinforce grounding:
- Explicitly instruct "only use the provided context"
- Ask for citations
- Use lower temperature (less creativity)
- Validate outputs against retrieved content</p>
<h3 id="citation-and-attribution">Citation and Attribution<a class="headerlink" href="#citation-and-attribution" title="Permanent link">&para;</a></h3>
<p>For trustworthiness, have the model cite sources:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>Based on the Q3 Financial Report, revenue increased by 15%...
</span></code></pre></div>
<p>You can enforce this structurally:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="s2">Answer the question based on the context. For each fact in your answer, cite the source in [brackets].</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="s2">Context:</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="s2">[Source: Q3 Report] Revenue increased 15% year over year.</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="s2">[Source: Press Release] The new product launched in September.</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="s2">Question: What happened in Q3?</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="s2">Answer:</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="s2">&quot;&quot;&quot;</span>
</span></code></pre></div>
<p>Or ask for structured output:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">response_schema</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="s2">&quot;answer&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;list of source names used&quot;</span><span class="p">]</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="handling-i-dont-know">Handling "I Don't Know"<a class="headerlink" href="#handling-i-dont-know" title="Permanent link">&para;</a></h3>
<p>The model should refuse to answer when context is insufficient.</p>
<p>This is difficult because:
- Models are trained to be helpful
- Models have training knowledge they might use
- Models sometimes hallucinate rather than admit ignorance</p>
<p>Strategies:
- Explicit instruction: "If you don't know, say 'I don't know'"
- Two-step: First ask "Can you answer based on the context?" then answer
- Confidence scoring: Have model rate its confidence
- Retrieval quality check: Don't send to LLM if retrieval failed</p>
<p>There's no perfect solution. Test with known-unknowable questions and tune prompts.</p>
<hr />
<h2 id="9-what-breaks-in-production">9. What Breaks in Production<a class="headerlink" href="#9-what-breaks-in-production" title="Permanent link">&para;</a></h2>
<p>RAG systems fail in predictable ways. Understanding these failures helps you build more robust systems.</p>
<h3 id="query-document-mismatch">Query-Document Mismatch<a class="headerlink" href="#query-document-mismatch" title="Permanent link">&para;</a></h3>
<p>Users ask questions differently than documents are written.</p>
<p><strong>User:</strong> "How do I fix the thing that's not working?"<br />
<strong>Document:</strong> "Troubleshooting Error Code E-7231"</p>
<p>The user's vague query doesn't match the document's specific terminology. Vector similarity may not bridge this gap.</p>
<p>Mitigations:
- Query expansion (add synonyms, rephrase)
- Hypothetical Document Embedding (HyDE) — generate what an answer might look like, embed that
- Hybrid search (keyword + semantic)
- Better document preprocessing (add summaries, keywords)</p>
<h3 id="retrieval-failures">Retrieval Failures<a class="headerlink" href="#retrieval-failures" title="Permanent link">&para;</a></h3>
<p>The relevant document exists but wasn't retrieved.</p>
<p>Causes:
- Query too different from document phrasing
- Document chunk split the answer
- Not enough top-k results
- Wrong embedding model for domain</p>
<p>Diagnosis: Log retrieved documents and manually check for failures. Build evaluation datasets.</p>
<h3 id="hallucination-despite-context">Hallucination Despite Context<a class="headerlink" href="#hallucination-despite-context" title="Permanent link">&para;</a></h3>
<p>The model has the right context but still hallucinates.</p>
<p>Causes:
- Model's training knowledge contradicts context
- Context is unclear or ambiguous
- Instructions not strong enough
- Temperature too high</p>
<p>Mitigations:
- Stronger grounding instructions
- Lower temperature
- Output validation
- Citation requirements</p>
<h3 id="latency-at-scale">Latency at Scale<a class="headerlink" href="#latency-at-scale" title="Permanent link">&para;</a></h3>
<p>RAG adds latency at every step:
- Query embedding
- Vector search
- Context assembly
- Longer prompts = longer generation</p>
<p>At scale, each step needs optimization:
- Cache embeddings
- Use faster vector databases
- Limit context size
- Stream responses</p>
<h3 id="evaluation-how-to-know-if-its-working">Evaluation: How to Know If It's Working<a class="headerlink" href="#evaluation-how-to-know-if-its-working" title="Permanent link">&para;</a></h3>
<p>RAG quality is hard to measure because it depends on:
- Retrieval quality (did you get the right documents?)
- Generation quality (did the model use them correctly?)</p>
<p>Evaluation approaches:</p>
<p><strong>Retrieval metrics:</strong> Measure if relevant documents are in top-k results. Requires labeled query-document pairs.</p>
<p><strong>End-to-end metrics:</strong> Compare generated answers to gold-standard answers. Requires labeled query-answer pairs.</p>
<p><strong>LLM-as-judge:</strong> Have another LLM evaluate answer quality. Cheaper than human evaluation but noisy.</p>
<p><strong>Human evaluation:</strong> Best quality signal but expensive and slow.</p>
<p>For production, combine:
- Automated metrics (retrieval recall, answer similarity)
- Sampled human evaluation
- User feedback (thumbs up/down, corrections)</p>
<hr />
<h2 id="summary-the-rag-mental-model">Summary: The RAG Mental Model<a class="headerlink" href="#summary-the-rag-mental-model" title="Permanent link">&para;</a></h2>
<p>RAG is a pipeline that retrieves relevant documents and uses them as context for LLM generation.</p>
<p><strong>Ingestion</strong> happens offline: load documents, chunk them, embed chunks, store in vector database.</p>
<p><strong>Query</strong> happens at request time: embed query, search for similar chunks, assemble context, generate response.</p>
<p><strong>Chunking</strong> is critical. Too small loses context. Too large loses precision. Test with real queries.</p>
<p><strong>Retrieval</strong> finds related documents, not correct answers. Similarity != answer quality.</p>
<p><strong>Generation</strong> must be grounded. Instruct the model explicitly. Require citations. Handle unknowns.</p>
<p><strong>Production</strong> adds complexity: evaluation, caching, latency optimization, failure handling.</p>
<hr />
<h2 id="interview-framing">Interview Framing<a class="headerlink" href="#interview-framing" title="Permanent link">&para;</a></h2>
<p><strong>"What is RAG and when would you use it?"</strong></p>
<p>"RAG — Retrieval-Augmented Generation — is a pattern for giving LLMs access to knowledge they weren't trained on. You'd use it when you need current information, private data, or any knowledge not in the model's training set. It's an alternative to fine-tuning that's more flexible and easier to update. The core idea is: retrieve relevant documents at query time and include them in the prompt as context."</p>
<p><strong>"How would you design a RAG system for company documentation?"</strong></p>
<p>"First, ingest: parse documents, chunk them with overlap for context preservation, embed with a model like OpenAI's embeddings or sentence-transformers, store in a vector database like Pinecone. At query time: embed the query, retrieve top-5 similar chunks, assemble them into a prompt that instructs the model to answer only from context, and stream the response. Key decisions are chunk size — I'd test 400-600 tokens — and whether to use hybrid search for keyword matching on technical terms."</p>
<p><strong>"What are the main failure modes in RAG?"</strong></p>
<p>"Retrieval failures are most common: the relevant document exists but wasn't retrieved because the query phrasing was too different. Chunking failures: the answer was split across chunks and neither was complete. Grounding failures: the model ignores context and uses training knowledge or hallucinates. For each, you need different fixes: query expansion for retrieval, overlap and parent-child chunking for splits, stronger prompting and lower temperature for grounding."</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="January 24, 2026 06:38:54 UTC">January 24, 2026</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="January 24, 2026 06:38:54 UTC">January 24, 2026</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2026 Jayant Nehra
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Jay-Nehra" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/in/jayant-nehra" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.action.edit", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>